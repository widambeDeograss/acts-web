"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79295],{93938:function(a,b,c){var d=c(54870),e=c(75198),f=c(50152),g=c(35530),h=c(26936),i=c(84212),j=c(2e4),k=c(71091),l=c(33313),m=c(27222),n=c(22990),o=c(53017),p=c(89472),q=c(61338),r=c(67045),s=c(24692),t=c(67731),u=c(47394);function v(a){var b=Object.create(null);return a&&Object.keys(a).forEach(function(c){if("default"!==c){var d=Object.getOwnPropertyDescriptor(a,c);Object.defineProperty(b,c,d.get?d:{enumerable:!0,get:function(){return a[c]}})}}),b.default=a,Object.freeze(b)}var w=v(e),x=v(f),y=v(g),z=v(h),A=v(i),B=v(j),C=v(k),D=v(l),E=v(m),F=v(n),G=v(o),H=v(p),I=v(q),J=v(r),K=v(s),L=v(t),M=v(u);class N extends d.Observable{constructor(a,b){super(),this.doc=a,this.awareness=b}}class O{constructor(a,b){this.clock=a,this.len=b}}class P{constructor(){this.clients=new Map}}let Q=(a,b,c)=>b.clients.forEach((b,d)=>{let e=a.doc.store.clients.get(d);for(let f=0;f<b.length;f++){let g=b[f];bf(a,e,g.clock,g.len,c)}}),R=(a,b)=>{let c=0,d=a.length-1;for(;c<=d;){let e=x.floor((c+d)/2),f=a[e],g=f.clock;if(g<=b){if(b<g+f.len)return e;c=e+1}else d=e-1}return null},S=(a,b)=>{let c=a.clients.get(b.client);return void 0!==c&&null!==R(c,b.clock)},T=a=>{a.clients.forEach(a=>{a.sort((a,b)=>a.clock-b.clock);let b,c;for(b=1,c=1;b<a.length;b++){let d=a[c-1],e=a[b];d.clock+d.len>=e.clock?d.len=x.max(d.len,e.clock+e.len-d.clock):(c<b&&(a[c]=e),c++)}a.length=c})},U=a=>{let b=new P;for(let c=0;c<a.length;c++)a[c].clients.forEach((d,e)=>{if(!b.clients.has(e)){let f=d.slice();for(let g=c+1;g<a.length;g++)w.appendTo(f,a[g].clients.get(e)||[]);b.clients.set(e,f)}});return T(b),b},V=(a,b,c,d)=>{y.setIfUndefined(a.clients,b,()=>[]).push(new O(c,d))},W=()=>new P,X=a=>{let b=W();return a.clients.forEach((a,c)=>{let d=[];for(let e=0;e<a.length;e++){let f=a[e];if(f.deleted){let g=f.id.clock,h=f.length;if(e+1<a.length)for(let i=a[e+1];e+1<a.length&&i.deleted;i=a[++e+1])h+=i.length;d.push(new O(g,h))}}d.length>0&&b.clients.set(c,d)}),b},Y=(a,b)=>{z.writeVarUint(a.restEncoder,b.clients.size),w.from(b.clients.entries()).sort((a,b)=>b[0]-a[0]).forEach(([b,c])=>{a.resetDsCurVal(),z.writeVarUint(a.restEncoder,b);let d=c.length;z.writeVarUint(a.restEncoder,d);for(let e=0;e<d;e++){let f=c[e];a.writeDsClock(f.clock),a.writeDsLen(f.len)}})},Z=a=>{let b=new P,c=A.readVarUint(a.restDecoder);for(let d=0;d<c;d++){a.resetDsCurVal();let e=A.readVarUint(a.restDecoder),f=A.readVarUint(a.restDecoder);if(f>0){let g=y.setIfUndefined(b.clients,e,()=>[]);for(let h=0;h<f;h++)g.push(new O(a.readDsClock(),a.readDsLen()))}}return b},$=(a,b,c)=>{let d=new P,e=A.readVarUint(a.restDecoder);for(let f=0;f<e;f++){a.resetDsCurVal();let g=A.readVarUint(a.restDecoder),h=A.readVarUint(a.restDecoder),i=c.clients.get(g)||[],j=a6(c,g);for(let k=0;k<h;k++){let l=a.readDsClock(),m=l+a.readDsLen();if(l<j){j<m&&V(d,g,j,m-j);let n=a8(i,l),o=i[n];for(!o.deleted&&o.id.clock<l&&(i.splice(n+1,0,c9(b,o,l-o.id.clock)),n++);n<i.length;)if((o=i[n++]).id.clock<m)o.deleted||(m<o.id.clock+o.length&&i.splice(n,0,c9(b,o,m-o.id.clock)),o.delete(b));else break}else V(d,g,l,m-l)}}if(d.clients.size>0){let p=new aj;return z.writeVarUint(p.restEncoder,0),Y(p,d),p.toUint8Array()}return null},_=(a,b)=>a.clients.size===b.clients.size&&(a.clients.forEach((a,c)=>{let d=b.clients.get(c);if(void 0===d||a.length!==d.length)return!1;for(let e=0;e<a.length;e++){let f=a[e],g=d[e];if(f.clock!==g.clock||f.len!==g.len)return!1}}),!0),aa=B.uint32;class ab extends d.Observable{constructor({guid:a=B.uuidv4(),collectionid:b=null,gc:c=!0,gcFilter:d=()=>!0,meta:e=null,autoLoad:f=!1,shouldLoad:g=!0}={}){super(),this.gc=c,this.gcFilter=d,this.clientID=aa(),this.guid=a,this.collectionid=b,this.share=new Map,this.store=new a4,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=g,this.autoLoad=f,this.meta=e,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=C.create(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});let h=()=>C.create(a=>{let b=c=>{(void 0===c|| !0===c)&&(this.off("sync",b),a())};this.on("sync",b)});this.on("sync",a=>{!1===a&&this.isSynced&&(this.whenSynced=h()),this.isSynced=void 0===a|| !0===a,this.isLoaded||this.emit("load",[])}),this.whenSynced=h()}load(){let a=this._item;null===a||this.shouldLoad||bn(a.parent.doc,a=>{a.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(w.from(this.subdocs).map(a=>a.guid))}transact(a,b=null){return bn(this,a,b)}get(a,b=bS){let c=y.setIfUndefined(this.share,a,()=>{let a=new b;return a._integrate(this,null),a}),d=c.constructor;if(b!==bS&&d!==b){if(d===bS){let e=new b;e._map=c._map,c._map.forEach(a=>{for(;null!==a;a=a.left)a.parent=e}),e._start=c._start;for(let f=e._start;null!==f;f=f.right)f.parent=e;return e._length=c._length,this.share.set(a,e),e._integrate(this,null),e}throw Error(`Type with the name ${a} has already been defined with a different constructor`)}return c}getArray(a=""){return this.get(a,b9)}getText(a=""){return this.get(a,cu)}getMap(a=""){return this.get(a,cc)}getXmlFragment(a=""){return this.get(a,cx)}toJSON(){let a={};return this.share.forEach((b,c)=>{a[c]=b.toJSON()}),a}destroy(){w.from(this.subdocs).forEach(a=>a.destroy());let a=this._item;if(null!==a){this._item=null;let b=a.content;b.doc=new ab({guid:this.guid,...b.opts,shouldLoad:!1}),b.doc._item=a,bn(a.parent.doc,c=>{let d=b.doc;a.deleted||c.subdocsAdded.add(d),c.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(a,b){super.on(a,b)}off(a,b){super.off(a,b)}}class ac{constructor(a){this.restDecoder=a}resetDsCurVal(){}readDsClock(){return A.readVarUint(this.restDecoder)}readDsLen(){return A.readVarUint(this.restDecoder)}}class ad extends ac{readLeftID(){return aI(A.readVarUint(this.restDecoder),A.readVarUint(this.restDecoder))}readRightID(){return aI(A.readVarUint(this.restDecoder),A.readVarUint(this.restDecoder))}readClient(){return A.readVarUint(this.restDecoder)}readInfo(){return A.readUint8(this.restDecoder)}readString(){return A.readVarString(this.restDecoder)}readParentInfo(){return 1===A.readVarUint(this.restDecoder)}readTypeRef(){return A.readVarUint(this.restDecoder)}readLen(){return A.readVarUint(this.restDecoder)}readAny(){return A.readAny(this.restDecoder)}readBuf(){return D.copyUint8Array(A.readVarUint8Array(this.restDecoder))}readJSON(){return JSON.parse(A.readVarString(this.restDecoder))}readKey(){return A.readVarString(this.restDecoder)}}class ae{constructor(a){this.dsCurrVal=0,this.restDecoder=a}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=A.readVarUint(this.restDecoder),this.dsCurrVal}readDsLen(){let a=A.readVarUint(this.restDecoder)+1;return this.dsCurrVal+=a,a}}class af extends ae{constructor(a){super(a),this.keys=[],A.readVarUint(a),this.keyClockDecoder=new A.IntDiffOptRleDecoder(A.readVarUint8Array(a)),this.clientDecoder=new A.UintOptRleDecoder(A.readVarUint8Array(a)),this.leftClockDecoder=new A.IntDiffOptRleDecoder(A.readVarUint8Array(a)),this.rightClockDecoder=new A.IntDiffOptRleDecoder(A.readVarUint8Array(a)),this.infoDecoder=new A.RleDecoder(A.readVarUint8Array(a),A.readUint8),this.stringDecoder=new A.StringDecoder(A.readVarUint8Array(a)),this.parentInfoDecoder=new A.RleDecoder(A.readVarUint8Array(a),A.readUint8),this.typeRefDecoder=new A.UintOptRleDecoder(A.readVarUint8Array(a)),this.lenDecoder=new A.UintOptRleDecoder(A.readVarUint8Array(a))}readLeftID(){return new aG(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new aG(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return A.readAny(this.restDecoder)}readBuf(){return A.readVarUint8Array(this.restDecoder)}readJSON(){return A.readAny(this.restDecoder)}readKey(){let a=this.keyClockDecoder.read();if(a<this.keys.length)return this.keys[a];{let b=this.stringDecoder.read();return this.keys.push(b),b}}}class ag{constructor(){this.restEncoder=z.createEncoder()}toUint8Array(){return z.toUint8Array(this.restEncoder)}resetDsCurVal(){}writeDsClock(a){z.writeVarUint(this.restEncoder,a)}writeDsLen(a){z.writeVarUint(this.restEncoder,a)}}class ah extends ag{writeLeftID(a){z.writeVarUint(this.restEncoder,a.client),z.writeVarUint(this.restEncoder,a.clock)}writeRightID(a){z.writeVarUint(this.restEncoder,a.client),z.writeVarUint(this.restEncoder,a.clock)}writeClient(a){z.writeVarUint(this.restEncoder,a)}writeInfo(a){z.writeUint8(this.restEncoder,a)}writeString(a){z.writeVarString(this.restEncoder,a)}writeParentInfo(a){z.writeVarUint(this.restEncoder,a?1:0)}writeTypeRef(a){z.writeVarUint(this.restEncoder,a)}writeLen(a){z.writeVarUint(this.restEncoder,a)}writeAny(a){z.writeAny(this.restEncoder,a)}writeBuf(a){z.writeVarUint8Array(this.restEncoder,a)}writeJSON(a){z.writeVarString(this.restEncoder,JSON.stringify(a))}writeKey(a){z.writeVarString(this.restEncoder,a)}}class ai{constructor(){this.restEncoder=z.createEncoder(),this.dsCurrVal=0}toUint8Array(){return z.toUint8Array(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(a){let b=a-this.dsCurrVal;this.dsCurrVal=a,z.writeVarUint(this.restEncoder,b)}writeDsLen(a){0===a&&E.unexpectedCase(),z.writeVarUint(this.restEncoder,a-1),this.dsCurrVal+=a}}class aj extends ai{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new z.IntDiffOptRleEncoder,this.clientEncoder=new z.UintOptRleEncoder,this.leftClockEncoder=new z.IntDiffOptRleEncoder,this.rightClockEncoder=new z.IntDiffOptRleEncoder,this.infoEncoder=new z.RleEncoder(z.writeUint8),this.stringEncoder=new z.StringEncoder,this.parentInfoEncoder=new z.RleEncoder(z.writeUint8),this.typeRefEncoder=new z.UintOptRleEncoder,this.lenEncoder=new z.UintOptRleEncoder}toUint8Array(){let a=z.createEncoder();return z.writeVarUint(a,0),z.writeVarUint8Array(a,this.keyClockEncoder.toUint8Array()),z.writeVarUint8Array(a,this.clientEncoder.toUint8Array()),z.writeVarUint8Array(a,this.leftClockEncoder.toUint8Array()),z.writeVarUint8Array(a,this.rightClockEncoder.toUint8Array()),z.writeVarUint8Array(a,z.toUint8Array(this.infoEncoder)),z.writeVarUint8Array(a,this.stringEncoder.toUint8Array()),z.writeVarUint8Array(a,z.toUint8Array(this.parentInfoEncoder)),z.writeVarUint8Array(a,this.typeRefEncoder.toUint8Array()),z.writeVarUint8Array(a,this.lenEncoder.toUint8Array()),z.writeUint8Array(a,z.toUint8Array(this.restEncoder)),z.toUint8Array(a)}writeLeftID(a){this.clientEncoder.write(a.client),this.leftClockEncoder.write(a.clock)}writeRightID(a){this.clientEncoder.write(a.client),this.rightClockEncoder.write(a.clock)}writeClient(a){this.clientEncoder.write(a)}writeInfo(a){this.infoEncoder.write(a)}writeString(a){this.stringEncoder.write(a)}writeParentInfo(a){this.parentInfoEncoder.write(a?1:0)}writeTypeRef(a){this.typeRefEncoder.write(a)}writeLen(a){this.lenEncoder.write(a)}writeAny(a){z.writeAny(this.restEncoder,a)}writeBuf(a){z.writeVarUint8Array(this.restEncoder,a)}writeJSON(a){z.writeAny(this.restEncoder,a)}writeKey(a){let b=this.keyMap.get(a);void 0===b?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(a)):this.keyClockEncoder.write(b)}}let ak=(a,b,c,d)=>{d=x.max(d,b[0].id.clock);let e=a8(b,d);z.writeVarUint(a.restEncoder,b.length-e),a.writeClient(c),z.writeVarUint(a.restEncoder,d);let f=b[e];f.write(a,d-f.id.clock);for(let g=e+1;g<b.length;g++)b[g].write(a,0)},al=(a,b,c)=>{let d=new Map;c.forEach((a,c)=>{a6(b,c)>a&&d.set(c,a)}),a5(b).forEach((a,b)=>{c.has(b)||d.set(b,0)}),z.writeVarUint(a.restEncoder,d.size),w.from(d.entries()).sort((a,b)=>b[0]-a[0]).forEach(([c,d])=>{ak(a,b.clients.get(c),c,d)})},am=(a,b)=>{let c=y.create(),d=A.readVarUint(a.restDecoder);for(let e=0;e<d;e++){let f=A.readVarUint(a.restDecoder),g=Array(f),h=a.readClient(),i=A.readVarUint(a.restDecoder);c.set(h,{i:0,refs:g});for(let j=0;j<f;j++){let k=a.readInfo();switch(F.BITS5&k){case 0:{let l=a.readLen();g[j]=new cH(aI(h,i),l),i+=l;break}case 10:{let m=A.readVarUint(a.restDecoder);g[j]=new df(aI(h,i),m),i+=m;break}default:{let n=(k&(F.BIT7|F.BIT8))==0,o=new dc(aI(h,i),null,(k&F.BIT8)===F.BIT8?a.readLeftID():null,null,(k&F.BIT7)===F.BIT7?a.readRightID():null,n?a.readParentInfo()?b.get(a.readString()):a.readLeftID():null,n&&(k&F.BIT6)===F.BIT6?a.readString():null,dd(a,k));g[j]=o,i+=o.length}}}}return c},an=(a,b,c)=>{let d=[],e=w.from(c.keys()).sort((a,b)=>a-b);if(0===e.length)return null;let f=()=>{if(0===e.length)return null;let a=c.get(e[e.length-1]);for(;a.refs.length===a.i;){if(e.pop(),!(e.length>0))return null;a=c.get(e[e.length-1])}return a},g=f();if(null===g&&0===d.length)return null;let h=new a4,i=new Map,j=(a,b)=>{let c=i.get(a);(null==c||c>b)&&i.set(a,b)},k=g.refs[g.i++],l=new Map,m=()=>{for(let a of d){let b=a.id.client,f=c.get(b);f?(f.i--,h.clients.set(b,f.refs.slice(f.i)),c.delete(b),f.i=0,f.refs=[]):h.clients.set(b,[a]),e=e.filter(a=>a!==b)}d.length=0};for(;;){if(k.constructor!==df){let n=y.setIfUndefined(l,k.id.client,()=>a6(b,k.id.client)),o=n-k.id.clock;if(o<0)d.push(k),j(k.id.client,k.id.clock-1),m();else{let p=k.getMissing(a,b);if(null!==p){d.push(k);let q=c.get(p)||{refs:[],i:0};if(q.refs.length===q.i)j(p,a6(b,p)),m();else{k=q.refs[q.i++];continue}}else(0===o||o<k.length)&&(k.integrate(a,o),l.set(k.id.client,k.id.clock+k.length))}}if(d.length>0)k=d.pop();else if(null!==g&&g.i<g.refs.length)k=g.refs[g.i++];else{if(null===(g=f()))break;k=g.refs[g.i++]}}if(h.clients.size>0){let r=new aj;return al(r,h,new Map),z.writeVarUint(r.restEncoder,0),{missing:i,update:r.toUint8Array()}}return null},ao=(a,b)=>al(a,b.doc.store,b.beforeState),ap=(a,b,c,d=new af(a))=>bn(b,a=>{a.local=!1;let b=!1,c=a.doc,e=c.store,f=am(d,c),g=an(a,e,f),h=e.pendingStructs;if(h){for(let[i,j]of h.missing)if(j<a6(e,i)){b=!0;break}if(g){for(let[k,l]of g.missing){let m=h.missing.get(k);(null==m||m>l)&&h.missing.set(k,l)}h.update=bA([h.update,g.update])}}else e.pendingStructs=g;let n=$(d,a,e);if(e.pendingDs){let o=new af(A.createDecoder(e.pendingDs));A.readVarUint(o.restDecoder);let p=$(o,a,e);n&&p?e.pendingDs=bA([n,p]):e.pendingDs=n||p}else e.pendingDs=n;if(b){let q=e.pendingStructs.update;e.pendingStructs=null,aq(a.doc,q)}},c,!1),aq=(a,b,c,d=af)=>{let e=A.createDecoder(b);ap(e,a,c,new d(e))},ar=(a,b,c)=>aq(a,b,c,ad),as=(a,b,c=new Map)=>{al(a,b.store,c),Y(a,X(b.store))},at=(a,b=new Uint8Array([0]),c=new aj)=>{let d=aw(b);as(c,a,d);let e=[c.toUint8Array()];if(a.store.pendingDs&&e.push(a.store.pendingDs),a.store.pendingStructs&&e.push(bB(a.store.pendingStructs.update,b)),e.length>1){if(c.constructor===ah)return bw(e.map((a,b)=>0===b?a:bH(a)));if(c.constructor===aj)return bA(e)}return e[0]},au=(a,b)=>at(a,b,new ah),av=a=>{let b=new Map,c=A.readVarUint(a.restDecoder);for(let d=0;d<c;d++){let e=A.readVarUint(a.restDecoder),f=A.readVarUint(a.restDecoder);b.set(e,f)}return b},aw=a=>av(new ac(A.createDecoder(a))),ax=(a,b)=>(z.writeVarUint(a.restEncoder,b.size),w.from(b.entries()).sort((a,b)=>b[0]-a[0]).forEach(([b,c])=>{z.writeVarUint(a.restEncoder,b),z.writeVarUint(a.restEncoder,c)}),a),ay=(a,b)=>ax(a,a5(b.store)),az=(a,b=new ai)=>(a instanceof Map?ax(b,a):ay(b,a),b.toUint8Array()),aA=a=>az(a,new ag);class aB{constructor(){this.l=[]}}let aC=()=>new aB,aD=(a,b)=>a.l.push(b),aE=(a,b)=>{let c=a.l,d=c.length;a.l=c.filter(a=>b!==a),d===a.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},aF=(a,b,c)=>G.callAll(a.l,[b,c]);class aG{constructor(a,b){this.client=a,this.clock=b}}let aH=(a,b)=>a===b||null!==a&&null!==b&&a.client===b.client&&a.clock===b.clock,aI=(a,b)=>new aG(a,b),aJ=(a,b)=>{z.writeVarUint(a,b.client),z.writeVarUint(a,b.clock)},aK=a=>aI(A.readVarUint(a),A.readVarUint(a)),aL=a=>{for(let[b,c]of a.doc.share.entries())if(c===a)return b;throw E.unexpectedCase()},aM=(a,b)=>{for(;null!==b;){if(b.parent===a)return!0;b=b.parent._item}return!1};class aN{constructor(a,b,c,d=0){this.type=a,this.tname=b,this.item=c,this.assoc=d}}let aO=a=>new aN(null==a.type?null:aI(a.type.client,a.type.clock),a.tname||null,null==a.item?null:aI(a.item.client,a.item.clock),null==a.assoc?0:a.assoc);class aP{constructor(a,b,c=0){this.type=a,this.index=b,this.assoc=c}}let aQ=(a,b,c=0)=>new aP(a,b,c),aR=(a,b,c)=>{let d=null,e=null;return null===a._item?e=aL(a):d=aI(a._item.id.client,a._item.id.clock),new aN(d,e,b,c)},aS=(a,b,c=0)=>{let d=a._start;if(c<0){if(0===b)return aR(a,null,c);b--}for(;null!==d;){if(!d.deleted&&d.countable){if(d.length>b)return aR(a,aI(d.id.client,d.id.clock+b),c);b-=d.length}if(null===d.right&&c<0)return aR(a,d.lastId,c);d=d.right}return aR(a,null,c)},aT=(a,b)=>{let{type:c,tname:d,item:e,assoc:f}=b;if(null!==e)z.writeVarUint(a,0),aJ(a,e);else if(null!==d)z.writeUint8(a,1),z.writeVarString(a,d);else if(null!==c)z.writeUint8(a,2),aJ(a,c);else throw E.unexpectedCase();return z.writeVarInt(a,f),a},aU=a=>{let b=z.createEncoder();return aT(b,a),z.toUint8Array(b)},aV=a=>{let b=null,c=null,d=null;switch(A.readVarUint(a)){case 0:d=aK(a);break;case 1:c=A.readVarString(a);break;case 2:b=aK(a)}let e=A.hasContent(a)?A.readVarInt(a):0;return new aN(b,c,d,e)},aW=a=>aV(A.createDecoder(a)),aX=(a,b)=>{let c=b.store,d=a.item,e=a.type,f=a.tname,g=a.assoc,h=null,i=0;if(null!==d){if(a6(c,d.client)<=d.clock)return null;let j=c7(c,d),k=j.item;if(!(k instanceof dc))return null;if(null===(h=k.parent)._item||!h._item.deleted){i=k.deleted||!k.countable?0:j.diff+(g>=0?0:1);let l=k.left;for(;null!==l;)!l.deleted&&l.countable&&(i+=l.length),l=l.left}}else{if(null!==f)h=b.get(f);else if(null!==e){if(a6(c,e.client)<=e.clock)return null;let{item:m}=c7(c,e);if(!(m instanceof dc)||!(m.content instanceof c5))return null;h=m.content.type}else throw E.unexpectedCase();i=g>=0?h._length:0}return aQ(h,i,a.assoc)},aY=(a,b)=>a===b||null!==a&&null!==b&&a.tname===b.tname&&aH(a.item,b.item)&&aH(a.type,b.type)&&a.assoc===b.assoc;class aZ{constructor(a,b){this.ds=a,this.sv=b}}let a$=(a,b=new ai)=>(Y(b,a.ds),ax(b,a.sv),b.toUint8Array()),a_=(a,b=new ae(A.createDecoder(a)))=>new aZ(Z(b),av(b)),a0=(a,b)=>new aZ(a,b),a1=(a0(W(),new Map),(a,b)=>void 0===b?!a.deleted:b.sv.has(a.id.client)&&(b.sv.get(a.id.client)||0)>a.id.clock&&!S(b.ds,a.id)),a2=(a,b)=>{let c=y.setIfUndefined(a.meta,a2,H.create),d=a.doc.store;c.has(b)||(b.sv.forEach((b,c)=>{b<a6(d,c)&&bc(a,aI(c,b))}),Q(a,b.ds,a=>{}),c.add(b))},a3=(a,b,c=af)=>{let d=new c(A.createDecoder(b)),e=new bs(d,!1);for(let f=e.curr;null!==f;f=e.next())if((a.sv.get(f.id.client)||0)<f.id.clock+f.length)return!1;let g=U([a.ds,Z(d)]);return _(a.ds,g)};class a4{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}let a5=a=>{let b=new Map;return a.clients.forEach((a,c)=>{let d=a[a.length-1];b.set(c,d.id.clock+d.length)}),b},a6=(a,b)=>{let c=a.clients.get(b);if(void 0===c)return 0;let d=c[c.length-1];return d.id.clock+d.length},a7=(a,b)=>{let c=a.clients.get(b.id.client);if(void 0===c)c=[],a.clients.set(b.id.client,c);else{let d=c[c.length-1];if(d.id.clock+d.length!==b.id.clock)throw E.unexpectedCase()}c.push(b)},a8=(a,b)=>{let c=0,d=a.length-1,e=a[d],f=e.id.clock;if(f===b)return d;let g=x.floor(b/(f+e.length-1)*d);for(;c<=d;){if((f=(e=a[g]).id.clock)<=b){if(b<f+e.length)return g;c=g+1}else d=g-1;g=x.floor((c+d)/2)}throw E.unexpectedCase()},a9=(a,b)=>{let c=a.clients.get(b.client);return c[a8(c,b.clock)]},ba=a9,bb=(a,b,c)=>{let d=a8(b,c),e=b[d];return e.id.clock<c&&e instanceof dc?(b.splice(d+1,0,c9(a,e,c-e.id.clock)),d+1):d},bc=(a,b)=>{let c=a.doc.store.clients.get(b.client);return c[bb(a,c,b.clock)]},bd=(a,b,c)=>{let d=b.clients.get(c.client),e=a8(d,c.clock),f=d[e];return c.clock!==f.id.clock+f.length-1&&f.constructor!==cH&&d.splice(e+1,0,c9(a,f,c.clock-f.id.clock+1)),f},be=(a,b,c)=>{let d=a.clients.get(b.id.client);d[a8(d,b.id.clock)]=c},bf=(a,b,c,d,e)=>{if(0===d)return;let f=c+d,g=bb(a,b,c),h;do f<(h=b[g++]).id.clock+h.length&&bb(a,b,f),e(h);while(g<b.length&&b[g].id.clock<f)};class bg{constructor(a,b,c){this.doc=a,this.deleteSet=new P,this.beforeState=a5(a.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=b,this.meta=new Map,this.local=c,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}let bh=(a,b)=>!!(0!==b.deleteSet.clients.size||y.any(b.afterState,(a,c)=>b.beforeState.get(c)!==a))&&(T(b.deleteSet),ao(a,b),Y(a,b.deleteSet),!0),bi=(a,b,c)=>{let d=b._item;(null===d||d.id.clock<(a.beforeState.get(d.id.client)||0)&&!d.deleted)&&y.setIfUndefined(a.changed,b,H.create).add(c)},bj=(a,b)=>{let c=a[b-1],d=a[b];c.deleted===d.deleted&&c.constructor===d.constructor&&c.mergeWith(d)&&(a.splice(b,1),d instanceof dc&&null!==d.parentSub&&d.parent._map.get(d.parentSub)===d&&d.parent._map.set(d.parentSub,c))},bk=(a,b,c)=>{for(let[d,e]of a.clients.entries()){let f=b.clients.get(d);for(let g=e.length-1;g>=0;g--){let h=e[g],i=h.clock+h.len;for(let j=a8(f,h.clock),k=f[j];j<f.length&&k.id.clock<i;k=f[++j]){let l=f[j];if(h.clock+h.len<=l.id.clock)break;l instanceof dc&&l.deleted&&!l.keep&&c(l)&&l.gc(b,!1)}}}},bl=(a,b)=>{a.clients.forEach((a,c)=>{let d=b.clients.get(c);for(let e=a.length-1;e>=0;e--){let f=a[e],g=x.min(d.length-1,1+a8(d,f.clock+f.len-1));for(let h=g,i=d[h];h>0&&i.id.clock>=f.clock;i=d[--h])bj(d,h)}})},bm=(a,b)=>{if(b<a.length){let c=a[b],d=c.doc,e=d.store,f=c.deleteSet,g=c._mergeStructs;try{T(f),c.afterState=a5(c.doc.store),d.emit("beforeObserverCalls",[c,d]);let h=[];c.changed.forEach((a,b)=>h.push(()=>{null!==b._item&&b._item.deleted||b._callObserver(c,a)})),h.push(()=>{c.changedParentTypes.forEach((a,b)=>h.push(()=>{null!==b._item&&b._item.deleted||((a=a.filter(a=>null===a.target._item||!a.target._item.deleted)).forEach(a=>{a.currentTarget=b}),a.sort((a,b)=>a.path.length-b.path.length),aF(b._dEH,a,c))})),h.push(()=>d.emit("afterTransaction",[c,d]))}),o.callAll(h,[]),c._needFormattingCleanup&&cr(c)}finally{d.gc&&bk(f,e,d.gcFilter),bl(f,e),c.afterState.forEach((a,b)=>{let d=c.beforeState.get(b)||0;if(d!==a){let f=e.clients.get(b),g=x.max(a8(f,d),1);for(let h=f.length-1;h>=g;h--)bj(f,h)}});for(let i=0;i<g.length;i++){let{client:j,clock:k}=g[i].id,l=e.clients.get(j),m=a8(l,k);m+1<l.length&&bj(l,m+1),m>0&&bj(l,m)}if(c.local||c.afterState.get(d.clientID)===c.beforeState.get(d.clientID)||(I.print(I.ORANGE,I.BOLD,"[yjs] ",I.UNBOLD,I.RED,"Changed the client-id because another client seems to be using it."),d.clientID=aa()),d.emit("afterTransactionCleanup",[c,d]),d._observers.has("update")){let n=new ah,p=bh(n,c);p&&d.emit("update",[n.toUint8Array(),c.origin,d,c])}if(d._observers.has("updateV2")){let q=new aj,r=bh(q,c);r&&d.emit("updateV2",[q.toUint8Array(),c.origin,d,c])}let{subdocsAdded:s,subdocsLoaded:t,subdocsRemoved:u}=c;(s.size>0||u.size>0||t.size>0)&&(s.forEach(a=>{a.clientID=d.clientID,null==a.collectionid&&(a.collectionid=d.collectionid),d.subdocs.add(a)}),u.forEach(a=>d.subdocs.delete(a)),d.emit("subdocs",[{loaded:t,added:s,removed:u},d,c]),u.forEach(a=>a.destroy())),a.length<=b+1?(d._transactionCleanups=[],d.emit("afterAllTransactions",[d,a])):bm(a,b+1)}}},bn=(a,b,c=null,d=!0)=>{let e=a._transactionCleanups,f=!1,g=null;null===a._transaction&&(f=!0,a._transaction=new bg(a,c,d),e.push(a._transaction),1===e.length&&a.emit("beforeAllTransactions",[a]),a.emit("beforeTransaction",[a._transaction,a]));try{g=b(a._transaction)}finally{if(f){let h=a._transaction===e[0];a._transaction=null,h&&bm(e,0)}}return g};class bo{constructor(a,b){this.insertions=b,this.deletions=a,this.meta=new Map}}let bp=(a,b,c)=>{Q(a,c.deletions,a=>{a instanceof dc&&b.scope.some(b=>aM(b,a))&&c8(a,!1)})},bq=(a,b,c)=>{let d=null,e=null,f=a.doc,g=a.scope;if(bn(f,c=>{for(;b.length>0&&null===d;){let h=f.store,i=b.pop(),j=new Set,k=[],l=!1;Q(c,i.insertions,a=>{if(a instanceof dc){if(null!==a.redone){let{item:b,diff:d}=c7(h,a.id);d>0&&(b=bc(c,aI(b.id.client,b.id.clock+d))),a=b}!a.deleted&&g.some(b=>aM(b,a))&&k.push(a)}}),Q(c,i.deletions,a=>{a instanceof dc&&g.some(b=>aM(b,a))&&!S(i.insertions,a.id)&&j.add(a)}),j.forEach(b=>{l=null!==db(c,b,j,i.insertions,a.ignoreRemoteMapChanges,a)||l});for(let m=k.length-1;m>=0;m--){let n=k[m];a.deleteFilter(n)&&(n.delete(c),l=!0)}d=l?i:null}c.changed.forEach((a,b)=>{a.has(null)&&b._searchMarker&&(b._searchMarker.length=0)}),e=c},a),null!=d){let h=e.changedParentTypes;a.emit("stack-item-popped",[{stackItem:d,type:c,changedParentTypes:h},a])}return d};class br extends d.Observable{constructor(a,{captureTimeout:b=500,captureTransaction:c=a=>!0,deleteFilter:d=()=>!0,trackedOrigins:e=new Set([null]),ignoreRemoteMapChanges:f=!1,doc:g=w.isArray(a)?a[0].doc:a.doc}={}){super(),this.scope=[],this.addToScope(a),this.deleteFilter=d,e.add(this),this.trackedOrigins=e,this.captureTransaction=c,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=g,this.lastChange=0,this.ignoreRemoteMapChanges=f,this.captureTimeout=b,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(b=>a.changedParentTypes.has(b))|| !this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;let b=this.undoing,c=this.redoing,d=b?this.redoStack:this.undoStack;b?this.stopCapturing():c||this.clear(!1,!0);let e=new P;a.afterState.forEach((b,c)=>{let d=a.beforeState.get(c)||0,f=b-d;f>0&&V(e,c,d,f)});let f=J.getUnixTime(),g=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&d.length>0&&!b&&!c){let h=d[d.length-1];h.deletions=U([h.deletions,a.deleteSet]),h.insertions=U([h.insertions,e])}else d.push(new bo(a.deleteSet,e)),g=!0;b||c||(this.lastChange=f),Q(a,a.deleteSet,a=>{a instanceof dc&&this.scope.some(b=>aM(b,a))&&c8(a,!0)});let i=[{stackItem:d[d.length-1],origin:a.origin,type:b?"redo":"undo",changedParentTypes:a.changedParentTypes},this];g?this.emit("stack-item-added",i):this.emit("stack-item-updated",i)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(a){(a=w.isArray(a)?a:[a]).forEach(a=>{this.scope.every(b=>b!==a)&&this.scope.push(a)})}addTrackedOrigin(a){this.trackedOrigins.add(a)}removeTrackedOrigin(a){this.trackedOrigins.delete(a)}clear(a=!0,b=!0){(a&&this.canUndo()||b&&this.canRedo())&&this.doc.transact(c=>{a&&(this.undoStack.forEach(a=>bp(c,this,a)),this.undoStack=[]),b&&(this.redoStack.forEach(a=>bp(c,this,a)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:a,redoStackCleared:b}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let a;try{a=bq(this,this.undoStack,"undo")}finally{this.undoing=!1}return a}redo(){this.redoing=!0;let a;try{a=bq(this,this.redoStack,"redo")}finally{this.redoing=!1}return a}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}class bs{constructor(a,b){this.gen=function*(a){let b=A.readVarUint(a.restDecoder);for(let c=0;c<b;c++){let d=A.readVarUint(a.restDecoder),e=a.readClient(),f=A.readVarUint(a.restDecoder);for(let g=0;g<d;g++){let h=a.readInfo();if(10===h){let i=A.readVarUint(a.restDecoder);yield new df(aI(e,f),i),f+=i}else if((F.BITS5&h)!=0){let j=(h&(F.BIT7|F.BIT8))==0,k=new dc(aI(e,f),null,(h&F.BIT8)===F.BIT8?a.readLeftID():null,null,(h&F.BIT7)===F.BIT7?a.readRightID():null,j?a.readParentInfo()?a.readString():a.readLeftID():null,j&&(h&F.BIT6)===F.BIT6?a.readString():null,dd(a,h));yield k,f+=k.length}else{let l=a.readLen();yield new cH(aI(e,f),l),f+=l}}}}(a),this.curr=null,this.done=!1,this.filterSkips=b,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===df);return this.curr}}let bt=(a,b=af)=>{let c=[],d=new b(A.createDecoder(a)),e=new bs(d,!1);for(let f=e.curr;null!==f;f=e.next())c.push(f);I.print("Structs: ",c);let g=Z(d);I.print("DeleteSet: ",g)},bu=(a,b=af)=>{let c=[],d=new b(A.createDecoder(a)),e=new bs(d,!1);for(let f=e.curr;null!==f;f=e.next())c.push(f);return{structs:c,ds:Z(d)}};class bv{constructor(a){this.currClient=0,this.startClock=0,this.written=0,this.encoder=a,this.clientStructs=[]}}let bw=a=>bA(a,ad,ah),bx=(a,b=ai,c=af)=>{let d=new b,e=new bs(new c(A.createDecoder(a)),!1),f=e.curr;if(null===f)return z.writeVarUint(d.restEncoder,0),d.toUint8Array();{let g=0,h=f.id.client,i=0!==f.id.clock,j=i?0:f.id.clock+f.length;for(;null!==f;f=e.next())h!==f.id.client&&(0!==j&&(g++,z.writeVarUint(d.restEncoder,h),z.writeVarUint(d.restEncoder,j)),h=f.id.client,j=0,i=0!==f.id.clock),f.constructor===df&&(i=!0),i||(j=f.id.clock+f.length);0!==j&&(g++,z.writeVarUint(d.restEncoder,h),z.writeVarUint(d.restEncoder,j));let k=z.createEncoder();return z.writeVarUint(k,g),z.writeBinaryEncoder(k,d.restEncoder),d.restEncoder=k,d.toUint8Array()}},by=(a,b=af)=>{let c=new Map,d=new Map,e=new bs(new b(A.createDecoder(a)),!1),f=e.curr;if(null!==f){let g=f.id.client,h=f.id.clock;for(c.set(g,h);null!==f;f=e.next())g!==f.id.client&&(d.set(g,h),c.set(f.id.client,f.id.clock),g=f.id.client),h=f.id.clock+f.length;d.set(g,h)}return{from:c,to:d}},bz=(a,b)=>{if(a.constructor===cH){let{client:c,clock:d}=a.id;return new cH(aI(c,d+b),a.length-b)}if(a.constructor===df){let{client:e,clock:f}=a.id;return new df(aI(e,f+b),a.length-b)}{let g=a,{client:h,clock:i}=g.id;return new dc(aI(h,i+b),null,aI(h,i+b-1),null,g.rightOrigin,g.parent,g.parentSub,g.content.splice(b))}},bA=(a,b=af,c=aj)=>{if(1===a.length)return a[0];let d=a.map(a=>new b(A.createDecoder(a))),e=d.map(a=>new bs(a,!0)),f=null,g=new c,h=new bv(g);for(;(e=e.filter(a=>null!==a.curr)).sort((a,b)=>{if(a.curr.id.client!==b.curr.id.client)return b.curr.id.client-a.curr.id.client;{let c=a.curr.id.clock-b.curr.id.clock;return 0===c?a.curr.constructor===b.curr.constructor?0:a.curr.constructor===df?1:-1:c}}),0!==e.length;){let i=e[0],j=i.curr.id.client;if(null!==f){let k=i.curr,l=!1;for(;null!==k&&k.id.clock+k.length<=f.struct.id.clock+f.struct.length&&k.id.client>=f.struct.id.client;)k=i.next(),l=!0;if(null===k||k.id.client!==j||l&&k.id.clock>f.struct.id.clock+f.struct.length)continue;if(j!==f.struct.id.client)bD(h,f.struct,f.offset),f={struct:k,offset:0},i.next();else if(f.struct.id.clock+f.struct.length<k.id.clock){if(f.struct.constructor===df)f.struct.length=k.id.clock+k.length-f.struct.id.clock;else{bD(h,f.struct,f.offset);let m=k.id.clock-f.struct.id.clock-f.struct.length,n=new df(aI(j,f.struct.id.clock+f.struct.length),m);f={struct:n,offset:0}}}else{let o=f.struct.id.clock+f.struct.length-k.id.clock;o>0&&(f.struct.constructor===df?f.struct.length-=o:k=bz(k,o)),f.struct.mergeWith(k)||(bD(h,f.struct,f.offset),f={struct:k,offset:0},i.next())}}else f={struct:i.curr,offset:0},i.next();for(let p=i.curr;null!==p&&p.id.client===j&&p.id.clock===f.struct.id.clock+f.struct.length&&p.constructor!==df;p=i.next())bD(h,f.struct,f.offset),f={struct:p,offset:0}}null!==f&&(bD(h,f.struct,f.offset),f=null),bE(h);let q=d.map(a=>Z(a)),r=U(q);return Y(g,r),g.toUint8Array()},bB=(a,b,c=af,d=aj)=>{let e=aw(b),f=new d,g=new bv(f),h=new c(A.createDecoder(a)),i=new bs(h,!1);for(;i.curr;){let j=i.curr,k=j.id.client,l=e.get(k)||0;if(i.curr.constructor===df){i.next();continue}if(j.id.clock+j.length>l)for(bD(g,j,x.max(l-j.id.clock,0)),i.next();i.curr&&i.curr.id.client===k;)bD(g,i.curr,0),i.next();else for(;i.curr&&i.curr.id.client===k&&i.curr.id.clock+i.curr.length<=l;)i.next()}bE(g);let m=Z(h);return Y(f,m),f.toUint8Array()},bC=a=>{a.written>0&&(a.clientStructs.push({written:a.written,restEncoder:z.toUint8Array(a.encoder.restEncoder)}),a.encoder.restEncoder=z.createEncoder(),a.written=0)},bD=(a,b,c)=>{a.written>0&&a.currClient!==b.id.client&&bC(a),0===a.written&&(a.currClient=b.id.client,a.encoder.writeClient(b.id.client),z.writeVarUint(a.encoder.restEncoder,b.id.clock+c)),b.write(a.encoder,c),a.written++},bE=a=>{bC(a);let b=a.encoder.restEncoder;z.writeVarUint(b,a.clientStructs.length);for(let c=0;c<a.clientStructs.length;c++){let d=a.clientStructs[c];z.writeVarUint(b,d.written),z.writeUint8Array(b,d.restEncoder)}},bF=(a,b,c,d)=>{let e=new c(A.createDecoder(a)),f=new bs(e,!1),g=new d,h=new bv(g);for(let i=f.curr;null!==i;i=f.next())bD(h,b(i),0);bE(h);let j=Z(e);return Y(g,j),g.toUint8Array()},bG=({formatting:a=!0,subdocs:b=!0,yxml:c=!0}={})=>{let d=0,e=y.create(),f=y.create(),g=y.create(),h=y.create();return h.set(null,null),i=>{switch(i.constructor){case cH:case df:return i;case dc:{let j=i,k=j.content;switch(k.constructor){case cK:break;case c5:if(c){let l=k.type;l instanceof cz&&(l.nodeName=y.setIfUndefined(f,l.nodeName,()=>"node-"+d)),l instanceof cC&&(l.hookName=y.setIfUndefined(f,l.hookName,()=>"hook-"+d))}break;case cV:{let m=k;m.arr=m.arr.map(()=>d);break}case cI:{let n=k;n.content=new Uint8Array([d]);break}case cN:{let o=k;b&&(o.opts={},o.doc.guid=d+"");break}case cP:{let p=k;p.embed={};break}case cR:{let q=k;a&&(q.key=y.setIfUndefined(g,q.key,()=>d+""),q.value=y.setIfUndefined(h,q.value,()=>({i:d})));break}case cT:{let r=k;r.arr=r.arr.map(()=>d);break}case cX:{let s=k;s.str=K.repeat(d%10+"",s.str.length);break}default:E.unexpectedCase()}return j.parentSub&&(j.parentSub=y.setIfUndefined(e,j.parentSub,()=>d+"")),d++,i}default:E.unexpectedCase()}}},bH=a=>bF(a,G.id,af,ah);class bI{constructor(a,b){this.target=a,this.currentTarget=a,this.transaction=b,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=bJ(this.currentTarget,this.target))}deletes(a){return S(this.transaction.deleteSet,a.id)}get keys(){if(null===this._keys){let a=new Map,b=this.target,c=this.transaction.changed.get(b);c.forEach(c=>{if(null!==c){let d=b._map.get(c),e,f;if(this.adds(d)){let g=d.left;for(;null!==g&&this.adds(g);)g=g.left;if(this.deletes(d)){if(!(null!==g&&this.deletes(g)))return;e="delete",f=w.last(g.content.getContent())}else null!==g&&this.deletes(g)?(e="update",f=w.last(g.content.getContent())):(e="add",f=void 0)}else{if(!this.deletes(d))return;e="delete",f=w.last(d.content.getContent())}a.set(c,{action:e,oldValue:f})}}),this._keys=a}return this._keys}get delta(){return this.changes.delta}adds(a){return a.id.clock>=(this.transaction.beforeState.get(a.id.client)||0)}get changes(){let a=this._changes;if(null===a){let b=this.target,c=H.create(),d=H.create(),e=[];a={added:c,deleted:d,delta:e,keys:this.keys};let f=this.transaction.changed.get(b);if(f.has(null)){let g=null,h=()=>{g&&e.push(g)};for(let i=b._start;null!==i;i=i.right)i.deleted?this.deletes(i)&&!this.adds(i)&&((null===g|| void 0===g.delete)&&(h(),g={delete:0}),g.delete+=i.length,d.add(i)):this.adds(i)?((null===g|| void 0===g.insert)&&(h(),g={insert:[]}),g.insert=g.insert.concat(i.content.getContent()),c.add(i)):((null===g|| void 0===g.retain)&&(h(),g={retain:0}),g.retain+=i.length);null!==g&& void 0===g.retain&&h()}this._changes=a}return a}}let bJ=(a,b)=>{let c=[];for(;null!==b._item&&b!==a;){if(null!==b._item.parentSub)c.unshift(b._item.parentSub);else{let d=0,e=b._item.parent._start;for(;e!==b._item&&null!==e;)!e.deleted&&d++,e=e.right;c.unshift(d)}b=b._item.parent}return c},bK=0;class bL{constructor(a,b){a.marker=!0,this.p=a,this.index=b,this.timestamp=bK++}}let bM=a=>{a.timestamp=bK++},bN=(a,b,c)=>{a.p.marker=!1,a.p=b,b.marker=!0,a.index=c,a.timestamp=bK++},bO=(a,b,c)=>{if(a.length>=80){let d=a.reduce((a,b)=>a.timestamp<b.timestamp?a:b);return bN(d,b,c),d}{let e=new bL(b,c);return a.push(e),e}},bP=(a,b)=>{if(null===a._start||0===b||null===a._searchMarker)return null;let c=0===a._searchMarker.length?null:a._searchMarker.reduce((a,c)=>x.abs(b-a.index)<x.abs(b-c.index)?a:c),d=a._start,e=0;for(null!==c&&(d=c.p,e=c.index,bM(c));null!==d.right&&e<b;){if(!d.deleted&&d.countable){if(b<e+d.length)break;e+=d.length}d=d.right}for(;null!==d.left&&e>b;)!(d=d.left).deleted&&d.countable&&(e-=d.length);for(;null!==d.left&&d.left.id.client===d.id.client&&d.left.id.clock+d.left.length===d.id.clock;)!(d=d.left).deleted&&d.countable&&(e-=d.length);return null!==c&&x.abs(c.index-e)<d.parent.length/80?(bN(c,d,e),c):bO(a._searchMarker,d,e)},bQ=(a,b,c)=>{for(let d=a.length-1;d>=0;d--){let e=a[d];if(c>0){let f=e.p;for(f.marker=!1;f&&(f.deleted||!f.countable);)(f=f.left)&&!f.deleted&&f.countable&&(e.index-=f.length);if(null===f|| !0===f.marker){a.splice(d,1);continue}e.p=f,f.marker=!0}(b<e.index||c>0&&b===e.index)&&(e.index=x.max(b,e.index+c))}},bR=(a,b,c)=>{let d=a,e=b.changedParentTypes;for(;y.setIfUndefined(e,a,()=>[]).push(c),null!==a._item;)a=a._item.parent;aF(d._eH,c,b)};class bS{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=aC(),this._dEH=aC(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(a,b){this.doc=a,this._item=b}_copy(){throw E.methodUnimplemented()}clone(){throw E.methodUnimplemented()}_write(a){}get _first(){let a=this._start;for(;null!==a&&a.deleted;)a=a.right;return a}_callObserver(a,b){!a.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(a){aD(this._eH,a)}observeDeep(a){aD(this._dEH,a)}unobserve(a){aE(this._eH,a)}unobserveDeep(a){aE(this._dEH,a)}toJSON(){}}let bT=(a,b,c)=>{b<0&&(b=a._length+b),c<0&&(c=a._length+c);let d=c-b,e=[],f=a._start;for(;null!==f&&d>0;){if(f.countable&&!f.deleted){let g=f.content.getContent();if(g.length<=b)b-=g.length;else{for(let h=b;h<g.length&&d>0;h++)e.push(g[h]),d--;b=0}}f=f.right}return e},bU=a=>{let b=[],c=a._start;for(;null!==c;){if(c.countable&&!c.deleted){let d=c.content.getContent();for(let e=0;e<d.length;e++)b.push(d[e])}c=c.right}return b},bV=(a,b)=>{let c=0,d=a._start;for(;null!==d;){if(d.countable&&!d.deleted){let e=d.content.getContent();for(let f=0;f<e.length;f++)b(e[f],c++,a)}d=d.right}},bW=(a,b)=>{let c=[];return bV(a,(d,e)=>{c.push(b(d,e,a))}),c},bX=a=>{let b=a._start,c=null,d=0;return{[Symbol.iterator](){return this},next:()=>{if(null===c){for(;null!==b&&b.deleted;)b=b.right;if(null===b)return{done:!0,value:void 0};c=b.content.getContent(),d=0,b=b.right}let a=c[d++];return c.length<=d&&(c=null),{done:!1,value:a}}}},bY=(a,b)=>{let c=bP(a,b),d=a._start;for(null!==c&&(d=c.p,b-=c.index);null!==d;d=d.right)if(!d.deleted&&d.countable){if(b<d.length)return d.content.getContent()[b];b-=d.length}},bZ=(a,b,c,d)=>{let e=c,f=a.doc,g=f.clientID,h=f.store,i=null===c?b._start:c.right,j=[],k=()=>{j.length>0&&((e=new dc(aI(g,a6(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new cV(j))).integrate(a,0),j=[])};d.forEach(c=>{if(null===c)j.push(c);else switch(c.constructor){case Number:case Object:case Boolean:case Array:case String:j.push(c);break;default:switch(k(),c.constructor){case Uint8Array:case ArrayBuffer:(e=new dc(aI(g,a6(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new cI(new Uint8Array(c)))).integrate(a,0);break;case ab:(e=new dc(aI(g,a6(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new cN(c))).integrate(a,0);break;default:if(c instanceof bS)(e=new dc(aI(g,a6(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new c5(c))).integrate(a,0);else throw Error("Unexpected content type in insert operation")}}}),k()},b$=E.create("Length exceeded!"),b_=(a,b,c,d)=>{if(c>b._length)throw b$;if(0===c)return b._searchMarker&&bQ(b._searchMarker,c,d.length),bZ(a,b,null,d);let e=c,f=bP(b,c),g=b._start;for(null!==f&&(g=f.p,c-=f.index,0===c&&(c+=(g=g.prev)&&g.countable&&!g.deleted?g.length:0));null!==g;g=g.right)if(!g.deleted&&g.countable){if(c<=g.length){c<g.length&&bc(a,aI(g.id.client,g.id.clock+c));break}c-=g.length}return b._searchMarker&&bQ(b._searchMarker,e,d.length),bZ(a,b,g,d)},b0=(a,b,c)=>{let d=(b._searchMarker||[]).reduce((a,b)=>b.index>a.index?b:a,{index:0,p:b._start}),e=d.p;if(e)for(;e.right;)e=e.right;return bZ(a,b,e,c)},b1=(a,b,c,d)=>{if(0===d)return;let e=c,f=d,g=bP(b,c),h=b._start;for(null!==g&&(h=g.p,c-=g.index);null!==h&&c>0;h=h.right)!h.deleted&&h.countable&&(c<h.length&&bc(a,aI(h.id.client,h.id.clock+c)),c-=h.length);for(;d>0&&null!==h;)h.deleted||(d<h.length&&bc(a,aI(h.id.client,h.id.clock+d)),h.delete(a),d-=h.length),h=h.right;if(d>0)throw b$;b._searchMarker&&bQ(b._searchMarker,e,-f+d)},b2=(a,b,c)=>{let d=b._map.get(c);void 0!==d&&d.delete(a)},b3=(a,b,c,d)=>{let e=b._map.get(c)||null,f=a.doc,g=f.clientID,h;if(null==d)h=new cV([d]);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:h=new cV([d]);break;case Uint8Array:h=new cI(d);break;case ab:h=new cN(d);break;default:if(d instanceof bS)h=new c5(d);else throw Error("Unexpected content type")}new dc(aI(g,a6(f.store,g)),e,e&&e.lastId,null,null,b,c,h).integrate(a,0)},b4=(a,b)=>{let c=a._map.get(b);return void 0===c||c.deleted?void 0:c.content.getContent()[c.length-1]},b5=a=>{let b={};return a._map.forEach((a,c)=>{a.deleted||(b[c]=a.content.getContent()[a.length-1])}),b},b6=(a,b)=>{let c=a._map.get(b);return void 0!==c&&!c.deleted},b7=a=>L.iteratorFilter(a.entries(),a=>!a[1].deleted);class b8 extends bI{constructor(a,b){super(a,b),this._transaction=b}}class b9 extends bS{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(a){let b=new b9;return b.push(a),b}_integrate(a,b){super._integrate(a,b),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new b9}clone(){let a=new b9;return a.insert(0,this.toArray().map(a=>a instanceof bS?a.clone():a)),a}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(a,b){super._callObserver(a,b),bR(this,a,new b8(this,a))}insert(a,b){null!==this.doc?bn(this.doc,c=>{b_(c,this,a,b)}):this._prelimContent.splice(a,0,...b)}push(a){null!==this.doc?bn(this.doc,b=>{b0(b,this,a)}):this._prelimContent.push(...a)}unshift(a){this.insert(0,a)}delete(a,b=1){null!==this.doc?bn(this.doc,c=>{b1(c,this,a,b)}):this._prelimContent.splice(a,b)}get(a){return bY(this,a)}toArray(){return bU(this)}slice(a=0,b=this.length){return bT(this,a,b)}toJSON(){return this.map(a=>a instanceof bS?a.toJSON():a)}map(a){return bW(this,a)}forEach(a){bV(this,a)}[Symbol.iterator](){return bX(this)}_write(a){a.writeTypeRef(c$)}}let ca=a=>new b9;class cb extends bI{constructor(a,b,c){super(a,b),this.keysChanged=c}}class cc extends bS{constructor(a){super(),this._prelimContent=null,void 0===a?this._prelimContent=new Map:this._prelimContent=new Map(a)}_integrate(a,b){super._integrate(a,b),this._prelimContent.forEach((a,b)=>{this.set(b,a)}),this._prelimContent=null}_copy(){return new cc}clone(){let a=new cc;return this.forEach((b,c)=>{a.set(c,b instanceof bS?b.clone():b)}),a}_callObserver(a,b){bR(this,a,new cb(this,a,b))}toJSON(){let a={};return this._map.forEach((b,c)=>{if(!b.deleted){let d=b.content.getContent()[b.length-1];a[c]=d instanceof bS?d.toJSON():d}}),a}get size(){return[...b7(this._map)].length}keys(){return L.iteratorMap(b7(this._map),a=>a[0])}values(){return L.iteratorMap(b7(this._map),a=>a[1].content.getContent()[a[1].length-1])}entries(){return L.iteratorMap(b7(this._map),a=>[a[0],a[1].content.getContent()[a[1].length-1]])}forEach(a){this._map.forEach((b,c)=>{b.deleted||a(b.content.getContent()[b.length-1],c,this)})}[Symbol.iterator](){return this.entries()}delete(a){null!==this.doc?bn(this.doc,b=>{b2(b,this,a)}):this._prelimContent.delete(a)}set(a,b){return null!==this.doc?bn(this.doc,c=>{b3(c,this,a,b)}):this._prelimContent.set(a,b),b}get(a){return b4(this,a)}has(a){return b6(this,a)}clear(){null!==this.doc?bn(this.doc,a=>{this.forEach(function(b,c,d){b2(a,d,c)})}):this._prelimContent.clear()}_write(a){a.writeTypeRef(c_)}}let cd=a=>new cc,ce=(a,b)=>a===b||"object"==typeof a&&"object"==typeof b&&a&&b&&M.equalFlat(a,b);class cf{constructor(a,b,c,d){this.left=a,this.right=b,this.index=c,this.currentAttributes=d}forward(){(null===this.right&&E.unexpectedCase(),this.right.content.constructor===cR)?this.right.deleted||cj(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}let cg=(a,b,c)=>{for(;null!==b.right&&c>0;)b.right.content.constructor===cR?b.right.deleted||cj(b.currentAttributes,b.right.content):b.right.deleted||(c<b.right.length&&bc(a,aI(b.right.id.client,b.right.id.clock+c)),b.index+=b.right.length,c-=b.right.length),b.left=b.right,b.right=b.right.right;return b},ch=(a,b,c)=>{let d=new Map,e=bP(b,c);if(e){let f=new cf(e.p.left,e.p,e.index,d);return cg(a,f,c-e.index)}{let g=new cf(null,b._start,0,d);return cg(a,g,c)}},ci=(a,b,c,d)=>{for(;null!==c.right&&(!0===c.right.deleted||c.right.content.constructor===cR&&ce(d.get(c.right.content.key),c.right.content.value));)c.right.deleted||d.delete(c.right.content.key),c.forward();let e=a.doc,f=e.clientID;d.forEach((d,g)=>{let h=c.left,i=c.right,j=new dc(aI(f,a6(e.store,f)),h,h&&h.lastId,i,i&&i.id,b,null,new cR(g,d));j.integrate(a,0),c.right=j,c.forward()})},cj=(a,b)=>{let{key:c,value:d}=b;null===d?a.delete(c):a.set(c,d)},ck=(a,b)=>{for(;null!==a.right&&(a.right.deleted||a.right.content.constructor===cR&&ce(b[a.right.content.key]||null,a.right.content.value));){a.forward()}},cl=(a,b,c,d)=>{let e=a.doc,f=e.clientID,g=new Map;for(let h in d){let i=d[h],j=c.currentAttributes.get(h)||null;if(!ce(j,i)){g.set(h,j);let{left:k,right:l}=c;c.right=new dc(aI(f,a6(e.store,f)),k,k&&k.lastId,l,l&&l.id,b,null,new cR(h,i)),c.right.integrate(a,0),c.forward()}}return g},cm=(a,b,c,d,e)=>{c.currentAttributes.forEach((a,b)=>{void 0===e[b]&&(e[b]=null)});let f=a.doc,g=f.clientID;ck(c,e);let h=cl(a,b,c,e),i=d.constructor===String?new cX(d):d instanceof bS?new c5(d):new cP(d),{left:j,right:k,index:l}=c;b._searchMarker&&bQ(b._searchMarker,c.index,i.getLength()),(k=new dc(aI(g,a6(f.store,g)),j,j&&j.lastId,k,k&&k.id,b,null,i)).integrate(a,0),c.right=k,c.index=l,c.forward(),ci(a,b,c,h)},cn=(a,b,c,d,e)=>{let f=a.doc,g=f.clientID;ck(c,e);let h=cl(a,b,c,e);iterationLoop:for(;null!==c.right&&(d>0||h.size>0&&(c.right.deleted||c.right.content.constructor===cR));){if(!c.right.deleted){if(c.right.content.constructor===cR){let{key:i,value:j}=c.right.content,k=e[i];if(void 0!==k){if(ce(k,j))h.delete(i);else{if(0===d)break iterationLoop;h.set(i,j)}c.right.delete(a)}else c.currentAttributes.set(i,j)}else d<c.right.length&&bc(a,aI(c.right.id.client,c.right.id.clock+d)),d-=c.right.length}c.forward()}if(d>0){let l="";for(;d>0;d--)l+="\n";c.right=new dc(aI(g,a6(f.store,g)),c.left,c.left&&c.left.lastId,c.right,c.right&&c.right.id,b,null,new cX(l)),c.right.integrate(a,0),c.forward()}ci(a,b,c,h)},co=(a,b,c,d,e)=>{let f=b,g=y.create();for(;f&&(!f.countable||f.deleted);){if(!f.deleted&&f.content.constructor===cR){let h=f.content;g.set(h.key,h)}f=f.right}let i=0,j=!1;for(;b!==f;){if(c===b&&(j=!0),!b.deleted){let k=b.content;if(k.constructor===cR){let{key:l,value:m}=k,n=d.get(l)||null;g.get(l)===k&&n!==m||(b.delete(a),i++,j||(e.get(l)||null)!==m||n===m||(null===n?e.delete(l):e.set(l,n))),j||b.deleted||cj(e,k)}}b=b.right}return i},cp=(a,b)=>{for(;b&&b.right&&(b.right.deleted||!b.right.countable);)b=b.right;let c=new Set;for(;b&&(b.deleted||!b.countable);){if(!b.deleted&&b.content.constructor===cR){let d=b.content.key;c.has(d)?b.delete(a):c.add(d)}b=b.left}},cq=a=>{let b=0;return bn(a.doc,c=>{let d=a._start,e=a._start,f=y.create(),g=y.copy(f);for(;e;)!1===e.deleted&&(e.content.constructor===cR?cj(g,e.content):(b+=co(c,d,e,f,g),f=y.copy(g),d=e)),e=e.right}),b},cr=a=>{let b=new Set,c=a.doc;for(let[d,e]of a.afterState.entries()){let f=a.beforeState.get(d)||0;e!==f&&bf(a,c.store.clients.get(d),f,e,a=>{a.deleted||a.content.constructor!==cR||a.constructor===cH||b.add(a.parent)})}bn(c,c=>{for(let d of(Q(a,a.deleteSet,a=>{if(a instanceof cH||b.has(a.parent))return;let d=a.parent;a.content.constructor===cR?b.add(d):cp(c,a)}),b))cq(d)})},cs=(a,b,c)=>{let d=c,e=y.copy(b.currentAttributes),f=b.right;for(;c>0&&null!==b.right;){if(!1===b.right.deleted)switch(b.right.content.constructor){case c5:case cP:case cX:c<b.right.length&&bc(a,aI(b.right.id.client,b.right.id.clock+c)),c-=b.right.length,b.right.delete(a)}b.forward()}f&&co(a,f,b.right,e,b.currentAttributes);let g=(b.left||b.right).parent;return g._searchMarker&&bQ(g._searchMarker,b.index,-d+c),b};class ct extends bI{constructor(a,b,c){super(a,b),this.childListChanged=!1,this.keysChanged=new Set,c.forEach(a=>{null===a?this.childListChanged=!0:this.keysChanged.add(a)})}get changes(){if(null===this._changes){let a={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=a}return this._changes}get delta(){if(null===this._delta){let a=this.target.doc,b=[];bn(a,a=>{let c=new Map,d=new Map,e=this.target._start,f=null,g={},h="",i=0,j=0,k=()=>{if(null!==f){let a=null;switch(f){case"delete":j>0&&(a={delete:j}),j=0;break;case"insert":("object"==typeof h||h.length>0)&&(a={insert:h},c.size>0&&(a.attributes={},c.forEach((b,c)=>{null!==b&&(a.attributes[c]=b)}))),h="";break;case"retain":i>0&&(a={retain:i},M.isEmpty(g)||(a.attributes=M.assign({},g))),i=0}a&&b.push(a),f=null}};for(;null!==e;){switch(e.content.constructor){case c5:case cP:this.adds(e)?this.deletes(e)||(k(),f="insert",h=e.content.getContent()[0],k()):this.deletes(e)?("delete"!==f&&(k(),f="delete"),j+=1):e.deleted||("retain"!==f&&(k(),f="retain"),i+=1);break;case cX:this.adds(e)?this.deletes(e)||("insert"!==f&&(k(),f="insert"),h+=e.content.str):this.deletes(e)?("delete"!==f&&(k(),f="delete"),j+=e.length):e.deleted||("retain"!==f&&(k(),f="retain"),i+=e.length);break;case cR:{let{key:l,value:m}=e.content;if(this.adds(e)){if(!this.deletes(e)){let n=c.get(l)||null;ce(n,m)?null!==m&&e.delete(a):("retain"===f&&k(),ce(m,d.get(l)||null)?delete g[l]:g[l]=m)}}else if(this.deletes(e)){d.set(l,m);let o=c.get(l)||null;ce(o,m)||("retain"===f&&k(),g[l]=o)}else if(!e.deleted){d.set(l,m);let p=g[l];void 0!==p&&(ce(p,m)?null!==p&&e.delete(a):("retain"===f&&k(),null===m?delete g[l]:g[l]=m))}e.deleted||("insert"===f&&k(),cj(c,e.content))}}e=e.right}for(k();b.length>0;){let q=b[b.length-1];if(void 0!==q.retain&& void 0===q.attributes)b.pop();else break}}),this._delta=b}return this._delta}}class cu extends bS{constructor(a){super(),this._pending=void 0!==a?[()=>this.insert(0,a)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(a,b){super._integrate(a,b);try{this._pending.forEach(a=>a())}catch(c){console.error(c)}this._pending=null}_copy(){return new cu}clone(){let a=new cu;return a.applyDelta(this.toDelta()),a}_callObserver(a,b){super._callObserver(a,b);let c=new ct(this,a,b);bR(this,a,c),a.local||(a._needFormattingCleanup=!0)}toString(){let a="",b=this._start;for(;null!==b;)!b.deleted&&b.countable&&b.content.constructor===cX&&(a+=b.content.str),b=b.right;return a}toJSON(){return this.toString()}applyDelta(a,{sanitize:b=!0}={}){null!==this.doc?bn(this.doc,c=>{let d=new cf(null,this._start,0,new Map);for(let e=0;e<a.length;e++){let f=a[e];if(void 0!==f.insert){let g=b||"string"!=typeof f.insert||e!==a.length-1||null!==d.right||"\n"!==f.insert.slice(-1)?f.insert:f.insert.slice(0,-1);("string"!=typeof g||g.length>0)&&cm(c,this,d,g,f.attributes||{})}else void 0!==f.retain?cn(c,this,d,f.retain,f.attributes||{}):void 0!==f.delete&&cs(c,d,f.delete)}}):this._pending.push(()=>this.applyDelta(a))}toDelta(a,b,c){let d=[],e=new Map,f=this.doc,g="",h=this._start;function i(){if(g.length>0){let a={},b=!1;e.forEach((c,d)=>{b=!0,a[d]=c});let c={insert:g};b&&(c.attributes=a),d.push(c),g=""}}let j=()=>{for(;null!==h;){if(a1(h,a)|| void 0!==b&&a1(h,b))switch(h.content.constructor){case cX:{let f=e.get("ychange");void 0===a||a1(h,a)?void 0===b||a1(h,b)?void 0!==f&&(i(),e.delete("ychange")):(void 0===f||f.user!==h.id.client||"added"!==f.type)&&(i(),e.set("ychange",c?c("added",h.id):{type:"added"})):(void 0===f||f.user!==h.id.client||"removed"!==f.type)&&(i(),e.set("ychange",c?c("removed",h.id):{type:"removed"})),g+=h.content.str;break}case c5:case cP:{i();let j={insert:h.content.getContent()[0]};if(e.size>0){let k={};j.attributes=k,e.forEach((a,b)=>{k[b]=a})}d.push(j);break}case cR:a1(h,a)&&(i(),cj(e,h.content))}h=h.right}i()};return a||b?bn(f,c=>{a&&a2(c,a),b&&a2(c,b),j()},"cleanup"):j(),d}insert(a,b,c){if(b.length<=0)return;let d=this.doc;null!==d?bn(d,d=>{let e=ch(d,this,a);c||(c={},e.currentAttributes.forEach((a,b)=>{c[b]=a})),cm(d,this,e,b,c)}):this._pending.push(()=>this.insert(a,b,c))}insertEmbed(a,b,c={}){let d=this.doc;null!==d?bn(d,d=>{let e=ch(d,this,a);cm(d,this,e,b,c)}):this._pending.push(()=>this.insertEmbed(a,b,c))}delete(a,b){if(0===b)return;let c=this.doc;null!==c?bn(c,c=>{cs(c,ch(c,this,a),b)}):this._pending.push(()=>this.delete(a,b))}format(a,b,c){if(0===b)return;let d=this.doc;null!==d?bn(d,d=>{let e=ch(d,this,a);null!==e.right&&cn(d,this,e,b,c)}):this._pending.push(()=>this.format(a,b,c))}removeAttribute(a){null!==this.doc?bn(this.doc,b=>{b2(b,this,a)}):this._pending.push(()=>this.removeAttribute(a))}setAttribute(a,b){null!==this.doc?bn(this.doc,c=>{b3(c,this,a,b)}):this._pending.push(()=>this.setAttribute(a,b))}getAttribute(a){return b4(this,a)}getAttributes(){return b5(this)}_write(a){a.writeTypeRef(c0)}}let cv=a=>new cu;class cw{constructor(a,b=()=>!0){this._filter=b,this._root=a,this._currentNode=a._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let a=this._currentNode,b=a&&a.content&&a.content.type;if(null!==a&&(!this._firstCall||a.deleted||!this._filter(b)))do if(b=a.content.type,a.deleted||b.constructor!==cz&&b.constructor!==cx||null===b._start)for(;null!==a;){if(null!==a.right){a=a.right;break}a=a.parent===this._root?null:a.parent._item}else a=b._start;while(null!==a&&(a.deleted||!this._filter(a.content.type)));return(this._firstCall=!1,null===a)?{value:void 0,done:!0}:(this._currentNode=a,{value:a.content.type,done:!1})}}class cx extends bS{constructor(){super(),this._prelimContent=[]}get firstChild(){let a=this._first;return a?a.content.getContent()[0]:null}_integrate(a,b){super._integrate(a,b),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new cx}clone(){let a=new cx;return a.insert(0,this.toArray().map(a=>a instanceof bS?a.clone():a)),a}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(a){return new cw(this,a)}querySelector(a){a=a.toUpperCase();let b=new cw(this,b=>b.nodeName&&b.nodeName.toUpperCase()===a),c=b.next();return c.done?null:c.value}querySelectorAll(a){return a=a.toUpperCase(),w.from(new cw(this,b=>b.nodeName&&b.nodeName.toUpperCase()===a))}_callObserver(a,b){bR(this,a,new cB(this,b,a))}toString(){return bW(this,a=>a.toString()).join("")}toJSON(){return this.toString()}toDOM(a=document,b={},c){let d=a.createDocumentFragment();return void 0!==c&&c._createAssociation(d,this),bV(this,e=>{d.insertBefore(e.toDOM(a,b,c),null)}),d}insert(a,b){null!==this.doc?bn(this.doc,c=>{b_(c,this,a,b)}):this._prelimContent.splice(a,0,...b)}insertAfter(a,b){if(null!==this.doc)bn(this.doc,c=>{let d=a&&a instanceof bS?a._item:a;bZ(c,this,d,b)});else{let c=this._prelimContent,d=null===a?0:c.findIndex(b=>b===a)+1;if(0===d&&null!==a)throw E.create("Reference item not found");c.splice(d,0,...b)}}delete(a,b=1){null!==this.doc?bn(this.doc,c=>{b1(c,this,a,b)}):this._prelimContent.splice(a,b)}toArray(){return bU(this)}push(a){this.insert(this.length,a)}unshift(a){this.insert(0,a)}get(a){return bY(this,a)}slice(a=0,b=this.length){return bT(this,a,b)}forEach(a){bV(this,a)}_write(a){a.writeTypeRef(c2)}}let cy=a=>new cx;class cz extends cx{constructor(a="UNDEFINED"){super(),this.nodeName=a,this._prelimAttrs=new Map}get nextSibling(){let a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){let a=this._item?this._item.prev:null;return a?a.content.type:null}_integrate(a,b){super._integrate(a,b),this._prelimAttrs.forEach((a,b)=>{this.setAttribute(b,a)}),this._prelimAttrs=null}_copy(){return new cz(this.nodeName)}clone(){let a=new cz(this.nodeName),b=this.getAttributes();return M.forEach(b,(b,c)=>{"string"==typeof b&&a.setAttribute(c,b)}),a.insert(0,this.toArray().map(a=>a instanceof bS?a.clone():a)),a}toString(){let a=this.getAttributes(),b=[],c=[];for(let d in a)c.push(d);c.sort();let e=c.length;for(let f=0;f<e;f++){let g=c[f];b.push(g+'="'+a[g]+'"')}let h=this.nodeName.toLocaleLowerCase(),i=b.length>0?" "+b.join(" "):"";return`<${h}${i}>${super.toString()}</${h}>`}removeAttribute(a){null!==this.doc?bn(this.doc,b=>{b2(b,this,a)}):this._prelimAttrs.delete(a)}setAttribute(a,b){null!==this.doc?bn(this.doc,c=>{b3(c,this,a,b)}):this._prelimAttrs.set(a,b)}getAttribute(a){return b4(this,a)}hasAttribute(a){return b6(this,a)}getAttributes(){return b5(this)}toDOM(a=document,b={},c){let d=a.createElement(this.nodeName),e=this.getAttributes();for(let f in e){let g=e[f];"string"==typeof g&&d.setAttribute(f,g)}return bV(this,e=>{d.appendChild(e.toDOM(a,b,c))}),void 0!==c&&c._createAssociation(d,this),d}_write(a){a.writeTypeRef(c1),a.writeKey(this.nodeName)}}let cA=a=>new cz(a.readKey());class cB extends bI{constructor(a,b,c){super(a,c),this.childListChanged=!1,this.attributesChanged=new Set,b.forEach(a=>{null===a?this.childListChanged=!0:this.attributesChanged.add(a)})}}class cC extends cc{constructor(a){super(),this.hookName=a}_copy(){return new cC(this.hookName)}clone(){let a=new cC(this.hookName);return this.forEach((b,c)=>{a.set(c,b)}),a}toDOM(a=document,b={},c){let d=b[this.hookName],e;return(e=void 0!==d?d.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),void 0!==c&&c._createAssociation(e,this),e}_write(a){a.writeTypeRef(c3),a.writeKey(this.hookName)}}let cD=a=>new cC(a.readKey());class cE extends cu{get nextSibling(){let a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){let a=this._item?this._item.prev:null;return a?a.content.type:null}_copy(){return new cE}clone(){let a=new cE;return a.applyDelta(this.toDelta()),a}toDOM(a=document,b,c){let d=a.createTextNode(this.toString());return void 0!==c&&c._createAssociation(d,this),d}toString(){return this.toDelta().map(a=>{let b=[];for(let c in a.attributes){let d=[];for(let e in a.attributes[c])d.push({key:e,value:a.attributes[c][e]});d.sort((a,b)=>a.key<b.key?-1:1),b.push({nodeName:c,attrs:d})}b.sort((a,b)=>a.nodeName<b.nodeName?-1:1);let f="";for(let g=0;g<b.length;g++){let h=b[g];f+=`<${h.nodeName}`;for(let i=0;i<h.attrs.length;i++){let j=h.attrs[i];f+=` ${j.key}="${j.value}"`}f+=">"}f+=a.insert;for(let k=b.length-1;k>=0;k--)f+=`</${b[k].nodeName}>`;return f}).join("")}toJSON(){return this.toString()}_write(a){a.writeTypeRef(c4)}}let cF=a=>new cE;class cG{constructor(a,b){this.id=a,this.length=b}get deleted(){throw E.methodUnimplemented()}mergeWith(a){return!1}write(a,b,c){throw E.methodUnimplemented()}integrate(a,b){throw E.methodUnimplemented()}}class cH extends cG{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,b){b>0&&(this.id.clock+=b,this.length-=b),a7(a.doc.store,this)}write(a,b){a.writeInfo(0),a.writeLen(this.length-b)}getMissing(a,b){return null}}class cI{constructor(a){this.content=a}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new cI(this.content)}splice(a){throw E.methodUnimplemented()}mergeWith(a){return!1}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeBuf(this.content)}getRef(){return 3}}let cJ=a=>new cI(a.readBuf());class cK{constructor(a){this.len=a}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new cK(this.len)}splice(a){let b=new cK(this.len-a);return this.len=a,b}mergeWith(a){return this.len+=a.len,!0}integrate(a,b){V(a.deleteSet,b.id.client,b.id.clock,this.len),b.markDeleted()}delete(a){}gc(a){}write(a,b){a.writeLen(this.len-b)}getRef(){return 1}}let cL=a=>new cK(a.readLen()),cM=(a,b)=>new ab({guid:a,...b,shouldLoad:b.shouldLoad||b.autoLoad||!1});class cN{constructor(a){a._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=a;let b={};this.opts=b,a.gc||(b.gc=!1),a.autoLoad&&(b.autoLoad=!0),null!==a.meta&&(b.meta=a.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new cN(cM(this.doc.guid,this.opts))}splice(a){throw E.methodUnimplemented()}mergeWith(a){return!1}integrate(a,b){this.doc._item=b,a.subdocsAdded.add(this.doc),this.doc.shouldLoad&&a.subdocsLoaded.add(this.doc)}delete(a){a.subdocsAdded.has(this.doc)?a.subdocsAdded.delete(this.doc):a.subdocsRemoved.add(this.doc)}gc(a){}write(a,b){a.writeString(this.doc.guid),a.writeAny(this.opts)}getRef(){return 9}}let cO=a=>new cN(cM(a.readString(),a.readAny()));class cP{constructor(a){this.embed=a}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new cP(this.embed)}splice(a){throw E.methodUnimplemented()}mergeWith(a){return!1}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeJSON(this.embed)}getRef(){return 5}}let cQ=a=>new cP(a.readJSON());class cR{constructor(a,b){this.key=a,this.value=b}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new cR(this.key,this.value)}splice(a){throw E.methodUnimplemented()}mergeWith(a){return!1}integrate(a,b){b.parent._searchMarker=null}delete(a){}gc(a){}write(a,b){a.writeKey(this.key),a.writeJSON(this.value)}getRef(){return 6}}let cS=a=>new cR(a.readKey(),a.readJSON());class cT{constructor(a){this.arr=a}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new cT(this.arr)}splice(a){let b=new cT(this.arr.slice(a));return this.arr=this.arr.slice(0,a),b}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){let c=this.arr.length;a.writeLen(c-b);for(let d=b;d<c;d++){let e=this.arr[d];a.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}let cU=a=>{let b=a.readLen(),c=[];for(let d=0;d<b;d++){let e=a.readString();"undefined"===e?c.push(void 0):c.push(JSON.parse(e))}return new cT(c)};class cV{constructor(a){this.arr=a}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new cV(this.arr)}splice(a){let b=new cV(this.arr.slice(a));return this.arr=this.arr.slice(0,a),b}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){let c=this.arr.length;a.writeLen(c-b);for(let d=b;d<c;d++){let e=this.arr[d];a.writeAny(e)}}getRef(){return 8}}let cW=a=>{let b=a.readLen(),c=[];for(let d=0;d<b;d++)c.push(a.readAny());return new cV(c)};class cX{constructor(a){this.str=a}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new cX(this.str)}splice(a){let b=new cX(this.str.slice(a));this.str=this.str.slice(0,a);let c=this.str.charCodeAt(a-1);return c>=55296&&c<=56319&&(this.str=this.str.slice(0,a-1)+"�",b.str="�"+b.str.slice(1)),b}mergeWith(a){return this.str+=a.str,!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeString(0===b?this.str:this.str.slice(b))}getRef(){return 4}}let cY=a=>new cX(a.readString()),cZ=[ca,cd,cv,cA,cy,cD,cF],c$=0,c_=1,c0=2,c1=3,c2=4,c3=5,c4=6;class c5{constructor(a){this.type=a}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new c5(this.type._copy())}splice(a){throw E.methodUnimplemented()}mergeWith(a){return!1}integrate(a,b){this.type._integrate(a.doc,b)}delete(a){let b=this.type._start;for(;null!==b;)b.deleted?a._mergeStructs.push(b):b.delete(a),b=b.right;this.type._map.forEach(b=>{b.deleted?a._mergeStructs.push(b):b.delete(a)}),a.changed.delete(this.type)}gc(a){let b=this.type._start;for(;null!==b;)b.gc(a,!0),b=b.right;this.type._start=null,this.type._map.forEach(b=>{for(;null!==b;)b.gc(a,!0),b=b.left}),this.type._map=new Map}write(a,b){this.type._write(a)}getRef(){return 7}}let c6=a=>new c5(cZ[a.readTypeRef()](a)),c7=(a,b)=>{let c=b,d=0,e;do d>0&&(c=aI(c.client,c.clock+d)),e=ba(a,c),d=c.clock-e.id.clock,c=e.redone;while(null!==c&&e instanceof dc);return{item:e,diff:d}},c8=(a,b)=>{for(;null!==a&&a.keep!==b;)a.keep=b,a=a.parent._item},c9=(a,b,c)=>{let{client:d,clock:e}=b.id,f=new dc(aI(d,e+c),b,aI(d,e+c-1),b.right,b.rightOrigin,b.parent,b.parentSub,b.content.splice(c));return b.deleted&&f.markDeleted(),b.keep&&(f.keep=!0),null!==b.redone&&(f.redone=aI(b.redone.client,b.redone.clock+c)),b.right=f,null!==f.right&&(f.right.left=f),a._mergeStructs.push(f),null!==f.parentSub&&null===f.right&&f.parent._map.set(f.parentSub,f),b.length=c,f},da=(a,b)=>w.some(a,a=>S(a.deletions,b)),db=(a,b,c,d,e,f)=>{let g=a.doc,h=g.store,i=g.clientID,j=b.redone;if(null!==j)return bc(a,j);let k=b.parent._item,l=null,m;if(null!==k&& !0===k.deleted){if(null===k.redone&&(!c.has(k)||null===db(a,k,c,d,e,f)))return null;for(;null!==k.redone;)k=bc(a,k.redone)}let n=null===k?b.parent:k.content.type;if(null===b.parentSub){for(l=b.left,m=b;null!==l;){let o=l;for(;null!==o&&o.parent._item!==k;)o=null===o.redone?null:bc(a,o.redone);if(null!==o&&o.parent._item===k){l=o;break}l=l.left}for(;null!==m;){let p=m;for(;null!==p&&p.parent._item!==k;)p=null===p.redone?null:bc(a,p.redone);if(null!==p&&p.parent._item===k){m=p;break}m=m.right}}else if(m=null,b.right&&!e){for(l=b;null!==l&&null!==l.right&&(l.right.redone||S(d,l.right.id)||da(f.undoStack,l.right.id)||da(f.redoStack,l.right.id));)for(l=l.right;l.redone;)l=bc(a,l.redone);if(l&&null!==l.right)return null}else l=n._map.get(b.parentSub)||null;let q=a6(h,i),r=aI(i,q),s=new dc(r,l,l&&l.lastId,m,m&&m.id,n,b.parentSub,b.content.copy());return b.redone=r,c8(s,!0),s.integrate(a,0),s};class dc extends cG{constructor(a,b,c,d,e,f,g,h){super(a,h.getLength()),this.origin=c,this.left=b,this.right=d,this.rightOrigin=e,this.parent=f,this.parentSub=g,this.redone=null,this.content=h,this.info=this.content.isCountable()?F.BIT2:0}set marker(a){(this.info&F.BIT4)>0!==a&&(this.info^=F.BIT4)}get marker(){return(this.info&F.BIT4)>0}get keep(){return(this.info&F.BIT1)>0}set keep(a){this.keep!==a&&(this.info^=F.BIT1)}get countable(){return(this.info&F.BIT2)>0}get deleted(){return(this.info&F.BIT3)>0}set deleted(a){this.deleted!==a&&(this.info^=F.BIT3)}markDeleted(){this.info|=F.BIT3}getMissing(a,b){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=a6(b,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=a6(b,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===aG&&this.id.client!==this.parent.client&&this.parent.clock>=a6(b,this.parent.client))return this.parent.client;if(this.origin&&(this.left=bd(a,b,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=bc(a,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===cH||this.right&&this.right.constructor===cH)&&(this.parent=null),this.parent){if(this.parent.constructor===aG){let c=ba(b,this.parent);c.constructor===cH?this.parent=null:this.parent=c.content.type}}else this.left&&this.left.constructor===dc&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===dc&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(a,b){if(b>0&&(this.id.clock+=b,this.left=bd(a,a.doc.store,aI(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(b),this.length-=b),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let c=this.left,d;if(null!==c)d=c.right;else if(null!==this.parentSub)for(d=this.parent._map.get(this.parentSub)||null;null!==d&&null!==d.left;)d=d.left;else d=this.parent._start;let e=new Set,f=new Set;for(;null!==d&&d!==this.right;){if(f.add(d),e.add(d),aH(this.origin,d.origin)){if(d.id.client<this.id.client)c=d,e.clear();else if(aH(this.rightOrigin,d.rightOrigin))break}else if(null!==d.origin&&f.has(ba(a.doc.store,d.origin)))e.has(ba(a.doc.store,d.origin))||(c=d,e.clear());else break;d=d.right}this.left=c}if(null!==this.left){let g=this.left.right;this.right=g,this.left.right=this}else{let h;if(null!==this.parentSub)for(h=this.parent._map.get(this.parentSub)||null;null!==h&&null!==h.left;)h=h.left;else h=this.parent._start,this.parent._start=this;this.right=h}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(a)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),a7(a.doc.store,this),this.content.integrate(a,this),bi(a,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(a)}else new cH(this.id,this.length).integrate(a,0)}get next(){let a=this.right;for(;null!==a&&a.deleted;)a=a.right;return a}get prev(){let a=this.left;for(;null!==a&&a.deleted;)a=a.left;return a}get lastId(){return 1===this.length?this.id:aI(this.id.client,this.id.clock+this.length-1)}mergeWith(a){if(this.constructor===a.constructor&&aH(a.origin,this.lastId)&&this.right===a&&aH(this.rightOrigin,a.rightOrigin)&&this.id.client===a.id.client&&this.id.clock+this.length===a.id.clock&&this.deleted===a.deleted&&null===this.redone&&null===a.redone&&this.content.constructor===a.content.constructor&&this.content.mergeWith(a.content)){let b=this.parent._searchMarker;return b&&b.forEach(b=>{b.p===a&&(b.p=this,!this.deleted&&this.countable&&(b.index-=this.length))}),a.keep&&(this.keep=!0),this.right=a.right,null!==this.right&&(this.right.left=this),this.length+=a.length,!0}return!1}delete(a){if(!this.deleted){let b=this.parent;this.countable&&null===this.parentSub&&(b._length-=this.length),this.markDeleted(),V(a.deleteSet,this.id.client,this.id.clock,this.length),bi(a,b,this.parentSub),this.content.delete(a)}}gc(a,b){if(!this.deleted)throw E.unexpectedCase();this.content.gc(a),b?be(a,this,new cH(this.id,this.length)):this.content=new cK(this.length)}write(a,b){let c=b>0?aI(this.id.client,this.id.clock+b-1):this.origin,d=this.rightOrigin,e=this.parentSub,f=this.content.getRef()&F.BITS5|(null===c?0:F.BIT8)|(null===d?0:F.BIT7)|(null===e?0:F.BIT6);if(a.writeInfo(f),null!==c&&a.writeLeftID(c),null!==d&&a.writeRightID(d),null===c&&null===d){let g=this.parent;if(void 0!==g._item){let h=g._item;if(null===h){let i=aL(g);a.writeParentInfo(!0),a.writeString(i)}else a.writeParentInfo(!1),a.writeLeftID(h.id)}else g.constructor===String?(a.writeParentInfo(!0),a.writeString(g)):g.constructor===aG?(a.writeParentInfo(!1),a.writeLeftID(g)):E.unexpectedCase();null!==e&&a.writeString(e)}this.content.write(a,b)}}let dd=(a,b)=>de[b&F.BITS5](a),de=[()=>{E.unexpectedCase()},cL,cU,cJ,cY,cQ,cS,c6,cW,cO,()=>{E.unexpectedCase()}];class df extends cG{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,b){E.unexpectedCase()}write(a,b){a.writeInfo(10),z.writeVarUint(a.restEncoder,this.length-b)}getMissing(a,b){return null}}let dg="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==c.g?c.g:{},dh="__ $YJS$ __";!0===dg[dh]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),dg[dh]=!0,b.QP=bS,b.mJ=b9,b.QW=ab,b.D5=cc,b.xv=cu,b.H6=br,b.eI=cE,b.bT=ct,b.NG=ar,b.Uq=aY,b.or=aX,b.Vc=X,b.og=aO,b.w$=aS,b.xF=aW,b.HM=aU,b.D$=au,b.gJ=aA}}])
//# sourceMappingURL=460fe597-3e784ef4571fa7c1.js.map